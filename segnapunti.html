<!DOCTYPE html>
    <html lang="it">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta name="theme-color" content="#d32f2f">
        <title>Segnapunti</title>
        <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/robertobrigantino-blip/todis-volley/main/logo.jpg">
        <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/robertobrigantino-blip/todis-volley/main/logo.jpg">
        <meta name="apple-mobile-web-app-capable" content="yes">
        
<style>
    body { font-family: 'Roboto', sans-serif; background-color: #f0f2f5; margin: 0; padding: 0; color: #333; padding-bottom: 80px; }
    
    /* Header */
    .app-header { background-color: #d32f2f; color: white; padding: 10px 15px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 5px rgba(0,0,0,0.2); position: sticky; top:0; z-index:1000; }
    .header-left { display: flex; align-items: center; gap: 10px; }
    .app-header img { height: 35px; width: 35px; border-radius: 50%; border: 2px solid white; object-fit: cover; }
    .app-header h1 { margin: 0; font-size: 14px; text-transform: uppercase; line-height: 1.1; font-weight: 700; }
    .last-update { font-size: 9px; opacity: 0.9; font-weight: normal; }
    
    /* Navigazione Header */
    .nav-buttons { display: flex; gap: 8px; }
    .btn-nav { background: rgba(255,255,255,0.2); color: white; text-decoration: none; font-size: 18px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; border: 1px solid rgba(255,255,255,0.4); }
    .btn-nav.active { background: white; color: #d32f2f; }

    /* Tabs */
    .tab-bar { background-color: white; display: flex; overflow-x: auto; white-space: nowrap; position: sticky; top: 54px; z-index: 99; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-bottom: 1px solid #eee; }
    .tab-btn { flex: 1; padding: 12px 15px; text-align: center; background: none; border: none; font-size: 13px; font-weight: 500; color: #666; border-bottom: 3px solid transparent; cursor: pointer; min-width: 100px; }
    .tab-btn.active { color: #d32f2f; border-bottom: 3px solid #d32f2f; font-weight: bold; }

    .tab-content { display: none; padding: 15px; max-width: 800px; margin: 0 auto; animation: fadeIn 0.3s; }
    .tab-content.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    h2 { color: #d32f2f; font-size: 16px; border-left: 4px solid #d32f2f; padding-left: 8px; margin-top: 15px; margin-bottom: 12px; }

    /* Classifica */
    .table-card { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 20px; }
    .table-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; width: 100%; }
    table { width: 100%; border-collapse: collapse; font-size: 12px; white-space: nowrap; }
    th { background-color: #ffebee; color: #c62828; padding: 10px 6px; text-align: center; font-weight: bold; font-size: 11px; text-transform: uppercase; }
    td { padding: 10px 6px; text-align: center; border-bottom: 1px solid #f0f0f0; }
    td:nth-child(2) { text-align: left; min-width: 140px; font-weight: 500; position: sticky; left: 0; background-color: white; border-right: 1px solid #eee; }
    .my-team-row td { background-color: #fff3e0 !important; font-weight: bold; }

    /* Card Partita */
    .match-card { background: white; border-radius: 8px; padding: 12px; margin-bottom: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border-left: 4px solid #ddd; position: relative; overflow: hidden; }
    .match-card.win { border-left-color: #2e7d32; } 
    .match-card.loss { border-left-color: #c62828; } 
    .match-card.upcoming { border-left-color: #ff9800; } 

    .result-badge { position: absolute; top: 0; right: 0; font-size: 9px; padding: 3px 6px; border-bottom-left-radius: 6px; font-weight: bold; color: white; z-index: 10; text-transform: uppercase; }
    .badge-win { background-color: #2e7d32; }
    .badge-loss { background-color: #c62828; }
    .badge-played { background-color: #78909c; } 

    .match-header { display: flex; align-items: center; gap: 8px; font-size: 11px; color: #666; margin-bottom: 8px; border-bottom: 1px solid #f5f5f5; padding-bottom: 5px; padding-right: 50px; }
    .date-badge { font-weight: bold; color: #d32f2f; display: flex; align-items: center; gap: 4px; }
    
    .teams { display: flex; flex-direction: column; gap: 6px; font-size: 14px; margin-bottom: 8px; }
    .team-row { display: flex; justify-content: space-between; align-items: center; }
    .my-team-text { color: #d32f2f; font-weight: 700; }
    .team-score { font-weight: bold; background: #eee; padding: 2px 8px; border-radius: 4px; min-width: 25px; text-align: center; }
    
    .match-footer { margin-top: 8px; padding-top: 8px; border-top: 1px solid #f5f5f5; display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 8px; }
    .gym-name { font-size: 11px; color: #666; width: 100%; display: block; margin-bottom: 5px; }
    
    .action-buttons { display: flex; gap: 5px; width: 100%; justify-content: flex-end; }
    .btn { text-decoration: none; padding: 5px 10px; border-radius: 15px; font-size: 10px; font-weight: bold; display: flex; align-items: center; gap: 3px; border: 1px solid transparent; }
    .btn-map { background-color: #e3f2fd; color: #1565c0; border-color: #bbdefb; }
    .btn-cal { background-color: #f3e5f5; color: #7b1fa2; border-color: #e1bee7; } 
    .btn-wa { background-color: #e8f5e9; color: #2e7d32; border-color: #c8e6c9; } 

    /* Modal */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(2px); }
    .modal-content { background: white; width: 85%; max-width: 400px; max-height: 80vh; border-radius: 12px; padding: 20px; overflow-y: auto; position: relative; box-shadow: 0 10px 25px rgba(0,0,0,0.2); animation: slideUp 0.3s; }
    @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }
    .modal-title { font-size: 18px; font-weight: bold; color: #d32f2f; }
    .close-btn { background: #eee; border: none; font-size: 24px; padding: 0 10px; border-radius: 5px; color: #555; cursor: pointer; }
    .modal-content .match-card { border: 1px solid #eee; box-shadow: none; padding: 10px; margin-bottom: 8px; }
    
    .footer-counter { text-align: center; margin-top: 30px; padding: 20px 0; border-top: 1px solid #eee; }
    .footer-counter img { height: 20px; vertical-align: middle; }
</style>
<script>
    function openTab(tabIndex) {
        var contents = document.getElementsByClassName("tab-content");
        for (var i = 0; i < contents.length; i++) contents[i].classList.remove("active");
        var buttons = document.getElementsByClassName("tab-btn");
        for (var i = 0; i < buttons.length; i++) buttons[i].classList.remove("active");
        document.getElementById("content-" + tabIndex).classList.add("active");
        document.getElementById("btn-" + tabIndex).classList.add("active");
    }
    
    function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }
    
    window.onload = function() {
        if (!document.title.toUpperCase().includes("TODIS") || document.title.includes("Segnapunti")) return;

        const today = new Date();
        today.setHours(0,0,0,0);
        let nextMatches = {};
        const allMatches = document.querySelectorAll('.match-card.upcoming');
        
        allMatches.forEach(card => {
            const isMyTeam = card.getAttribute('data-my-team');
            if(isMyTeam === 'true') {
                const dateStr = card.getAttribute('data-date-iso');
                const campName = card.getAttribute('data-camp');
                if (dateStr && campName) {
                    const parts = dateStr.split('-');
                    const matchDate = new Date(parts[0], parts[1]-1, parts[2]);
                    if (matchDate >= today) {
                        if (!nextMatches[campName] || matchDate < nextMatches[campName].date) {
                            nextMatches[campName] = { date: matchDate, html: card.outerHTML };
                        }
                    }
                }
            }
        });
        
        let popupHTML = "";
        let count = 0;
        for (const [camp, data] of Object.entries(nextMatches)) {
            popupHTML += `<h3>üèÜ ${camp}</h3>`;
            popupHTML += data.html;
            count++;
        }
        
        if (count > 0) {
            const modalBody = document.getElementById('modal-body');
            if(modalBody) {
                modalBody.innerHTML = popupHTML;
                setTimeout(function(){
                    document.getElementById('modal-overlay').style.display = 'flex';
                }, 500);
            }
        }
    };
</script>

         
        <style>.app-header { background-color: #333; }</style> 
    </head>
    <body>
        
        <div class="app-header">
            <div class="header-left">
                <img src="https://raw.githubusercontent.com/robertobrigantino-blip/todis-volley/main/logo.jpg" alt="Logo">
                <div><h1>Segnapunti</h1><div class="last-update">01/01 11:08</div></div>
            </div>
            <div class="nav-buttons">
                <a href="index.html" class="btn-nav">üè†</a>
            </div>
        </div>
    
<style>
    .sb-container { max-width: 600px; margin: 0 auto; padding: 10px; }
    .timer-card { background: #333; color: #fff; padding: 15px; border-radius: 10px; text-align: center; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
    .timer-display { font-size: 36px; font-weight: bold; font-family: monospace; letter-spacing: 2px; }
    .timer-controls { margin-top: 10px; display: flex; justify-content: center; gap: 10px; }
    .btn-timer { background: #555; color: white; border: none; padding: 8px 15px; border-radius: 5px; font-weight: bold; cursor: pointer; }
    .btn-timer.active { background: #d32f2f; }
    .score-area { display: flex; gap: 10px; margin-bottom: 20px; }
    .team-col { flex: 1; background: white; padding: 15px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-top: 5px solid #ddd; }
    .team-col.serving { border-top-color: #2e7d32; background: #e8f5e9; }
    .team-name-input { width: 100%; border: none; text-align: center; font-size: 16px; font-weight: bold; color: #333; background: transparent; margin-bottom: 10px; padding: 5px; border-bottom: 1px dashed #ccc; }
    .score-big { font-size: 70px; font-weight: 800; color: #333; line-height: 1; margin: 10px 0; user-select: none; }
    .score-controls { display: flex; justify-content: center; gap: 10px; }
    .btn-score { width: 40px; height: 40px; border-radius: 50%; border: none; font-size: 20px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .btn-plus { background: #d32f2f; color: white; }
    .btn-minus { background: #eee; color: #555; }
    .ball-icon { font-size: 14px; cursor: pointer; opacity: 0.2; }
    .serving .ball-icon { opacity: 1; }
    .sets-display { display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 20px; font-size: 18px; font-weight: bold; background: white; padding: 10px; border-radius: 30px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .set-score { font-size: 24px; color: #d32f2f; }
    .game-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
    .btn-ctrl { padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 14px; }
    .btn-new-set { background: #1976D2; color: white; }
    .btn-reset { background: #607D8B; color: white; }
</style>

<div class="sb-container">
    <div class="timer-card">
        <div class="timer-display" id="timer">00:00</div>
        <div class="timer-controls">
            <button class="btn-timer active" onclick="toggleTimer()" id="btnStartStop">‚ñ∂ Start</button>
            <button class="btn-timer" onclick="resetTimer()">‚Ü∫ Reset</button>
        </div>
    </div>
    <div class="sets-display">
        <span>SET:</span>
        <span id="setsHome" class="set-score">0</span>
        <span>-</span>
        <span id="setsGuest" class="set-score">0</span>
    </div>
    <div class="score-area">
        <div class="team-col" id="colHome" onclick="setService('Home')">
            <div class="ball-icon">üèê Servizio</div>
            <input type="text" class="team-name-input" value="CASA">
            <div class="score-big" id="scoreHome">0</div>
            <div class="score-controls">
                <button class="btn-score btn-minus" onclick="updateScore('Home', -1); event.stopPropagation()">-</button>
                <button class="btn-score btn-plus" onclick="updateScore('Home', 1); event.stopPropagation()">+</button>
            </div>
        </div>
        <div class="team-col" id="colGuest" onclick="setService('Guest')">
            <div class="ball-icon">üèê Servizio</div>
            <input type="text" class="team-name-input" value="OSPITI">
            <div class="score-big" id="scoreGuest">0</div>
            <div class="score-controls">
                <button class="btn-score btn-minus" onclick="updateScore('Guest', -1); event.stopPropagation()">-</button>
                <button class="btn-score btn-plus" onclick="updateScore('Guest', 1); event.stopPropagation()">+</button>
            </div>
        </div>
    </div>
    <div class="game-controls">
        <button class="btn-ctrl btn-new-set" onclick="endSet()">Fine Set üèÅ</button>
        <button class="btn-ctrl btn-reset" onclick="resetMatch()">Nuova Partita üîÑ</button>
    </div>
    <div style="text-align:center; margin-top:20px; font-size:11px; color:#777;">
        üí° Tocca il box squadra per assegnare la battuta.<br>Lo schermo rester√† attivo.
    </div>
</div>

<script>
    let scoreH = 0, scoreG = 0;
    let setsH = 0, setsG = 0;
    let timerInterval;
    let seconds = 0;
    let isRunning = false;
    let wakeLock = null;

    async function requestWakeLock() {
        try { wakeLock = await navigator.wakeLock.request('screen'); } catch (err) {}
    }
    document.addEventListener('click', requestWakeLock, {once:true});

    function updateScore(team, delta) {
        if (team === 'Home') {
            scoreH = Math.max(0, scoreH + delta);
            document.getElementById('scoreHome').innerText = scoreH;
        } else {
            scoreG = Math.max(0, scoreG + delta);
            document.getElementById('scoreGuest').innerText = scoreG;
        }
    }

    function setService(team) {
        document.getElementById('colHome').classList.remove('serving');
        document.getElementById('colGuest').classList.remove('serving');
        document.getElementById('col' + team).classList.add('serving');
    }

    function endSet() {
        if (!confirm("Chiudere il set corrente e aggiornare il conteggio set?")) return;
        if (scoreH > scoreG) setsH++; else if (scoreG > scoreH) setsG++;
        scoreH = 0; scoreG = 0;
        updateUI();
    }

    function resetMatch() {
        if (!confirm("Azzerare tutto e iniziare nuova partita?")) return;
        scoreH = 0; scoreG = 0; setsH = 0; setsG = 0; seconds = 0;
        stopTimer(); updateTimerDisplay(); updateUI();
    }

    function updateUI() {
        document.getElementById('scoreHome').innerText = scoreH;
        document.getElementById('scoreGuest').innerText = scoreG;
        document.getElementById('setsHome').innerText = setsH;
        document.getElementById('setsGuest').innerText = setsG;
    }

    function toggleTimer() { if (isRunning) stopTimer(); else startTimer(); }
    function startTimer() { isRunning = true; document.getElementById('btnStartStop').innerText = "‚è∏ Stop"; document.getElementById('btnStartStop').classList.remove('active'); timerInterval = setInterval(() => { seconds++; updateTimerDisplay(); }, 1000); }
    function stopTimer() { isRunning = false; document.getElementById('btnStartStop').innerText = "‚ñ∂ Start"; document.getElementById('btnStartStop').classList.add('active'); clearInterval(timerInterval); }
    function resetTimer() { stopTimer(); seconds = 0; updateTimerDisplay(); }
    function updateTimerDisplay() { const m = Math.floor(seconds / 60).toString().padStart(2, '0'); const s = (seconds % 60).toString().padStart(2, '0'); document.getElementById('timer').innerText = `${m}:${s}`; }
</script>
</body></html>